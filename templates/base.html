<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="logo">
                <img src="{{ url_for('static', filename='img/favicon.png') }}" alt="Logo" class="logo-img">
                <h2>æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="{% if request.path == '/' %}active{% endif %}"><span class="nav-label" title="é¦–é¡µ">é¦–é¡µ</span></a></li>
                <li><a href="/integrated" class="{% if request.path == '/integrated' %}active{% endif %}"><span class="nav-label" title="é›†æˆç›‘æ§">é›†æˆç›‘æ§</span></a></li>
                <li><a href="/servers" class="{% if request.path == '/servers' %}active{% endif %}"><span class="nav-label" title="æœåŠ¡å™¨ç®¡ç†">æœåŠ¡å™¨ç®¡ç†</span></a></li>
                <li class="nav-item has-submenu">
                    <a href="#" class="submenu-toggle"><span class="nav-label" title="å·¥ä½œæµ">å·¥ä½œæµ</span></a>
                    <ul class="submenu">
                        <li><a href="/workflow" class="{% if request.path == '/workflow' %}active{% endif %}"><span class="nav-label" title="ç³»ç»Ÿ">ç³»ç»Ÿ</span></a></li>
                        <li><a href="/sql" class="{% if request.path == '/sql' %}active{% endif %}"><span class="nav-label" title="SQL">SQL</span></a></li>
                        <li><a href="/api-page" class="{% if request.path == '/api-page' %}active{% endif %}"><span class="nav-label" title="æ¥å£">æ¥å£</span></a></li>
                    </ul>
                </li>
                <li><a href="#" class="coming-soon"><span class="nav-label" title="æœåŠ¡éƒ¨ç½²">æœåŠ¡éƒ¨ç½²</span></a></li>
            </ul>
            <div class="menu-toggle-container">
                <button id="menu-toggle" class="menu-toggle-btn">
                    <span class="menu-toggle-icon">â†</span>
                </button>
            </div>
        </nav>
        
        <main class="main-content">
            <header class="top-bar">
                {% block header_content %}
                <div class="top-bar-left">
                    <button id="theme-toggle" class="theme-toggle-btn">
                        <span class="theme-toggle-icon">ğŸŒ™</span>
                        <span class="theme-toggle-text">åˆ‡æ¢å‰ç«¯</span>
                    </button>
                    <h1>{% block page_title %}æœåŠ¡å™¨ç®¡ç†ç³»ç»Ÿ{% endblock %}</h1>
                </div>
                <div class="user-info">
                    <span id="current-time"></span>
                </div>
                {% endblock %}
            </header>
            
            {% block content %}{% endblock %}
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    {% block extra_js %}{% endblock %}
    
    <script>
        // å…¨å±€æ—¶é—´æ˜¾ç¤ºé€»è¾‘
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                const now = new Date();
                timeElement.textContent = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        // èœå•å±•å¼€/æ”¶å›é€»è¾‘
        document.addEventListener('DOMContentLoaded', function() {
            const submenuToggles = document.querySelectorAll('.submenu-toggle');
            
            submenuToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    const parentLi = this.closest('.has-submenu');
                    parentLi.classList.toggle('collapsed');
                    parentLi.classList.toggle('active');
                });
            });
            
            // èœå•éšè—/æ˜¾ç¤ºé€»è¾‘
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            
            if (menuToggle && sidebar) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                });
            }
            
            // å‰ç«¯åˆ‡æ¢é€»è¾‘
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.querySelector('.theme-toggle-icon');
            const themeText = document.querySelector('.theme-toggle-text');
            
            if (themeToggle) {
                // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„å‰ç«¯ç‰ˆæœ¬
                const currentTheme = localStorage.getItem('frontendVersion') || 'new';
                updateThemeUI(currentTheme);
                
                themeToggle.addEventListener('click', function() {
                    const currentTheme = localStorage.getItem('frontendVersion') || 'new';
                    const newTheme = currentTheme === 'new' ? 'old' : 'new';
                    localStorage.setItem('frontendVersion', newTheme);
                    updateThemeUI(newTheme);
                    
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„å‰ç«¯åˆ‡æ¢é€»è¾‘
                    alert(`å·²åˆ‡æ¢åˆ°${newTheme === 'new' ? 'æ–°' : 'æ—§'}å‰ç«¯ç‰ˆæœ¬`);
                });
            }
            
            function updateThemeUI(theme) {
                if (themeIcon && themeText) {
                    if (theme === 'new') {
                        themeIcon.textContent = 'ğŸŒ™';
                        themeText.textContent = 'åˆ‡æ¢åˆ°æ—§å‰ç«¯';
                    } else {
                        themeIcon.textContent = 'â˜€ï¸';
                        themeText.textContent = 'åˆ‡æ¢åˆ°æ–°å‰ç«¯';
                    }
                }
            }
        });
    </script>
</body>
</html>